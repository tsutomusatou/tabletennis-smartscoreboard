{"version":3,"sources":["../src/obniz/libs/embeds/bleHci/bleAdvertisement.ts"],"names":[],"mappings":"AAAA;;;GAGG;AACH,OAAO,QAAQ,MAAM,OAAO,CAAC;AAE7B,OAAO,uBAAuB,MAAM,2BAA2B,CAAC;AAChE,OAAO,EAAE,oBAAoB,EAAE,mBAAmB,EAAQ,MAAM,YAAY,CAAC;AAE7E;;GAEG;AACH,MAAM,CAAC,OAAO,OAAO,gBAAgB;IACnC,SAAS,CAAC,QAAQ,EAAE,QAAQ,CAAC;IAC7B,SAAS,CAAC,QAAQ,EAAE,MAAM,EAAE,CAAC;IAC7B,SAAS,CAAC,SAAS,EAAE,MAAM,EAAE,CAAC;gBAElB,QAAQ,EAAE,QAAQ;IAM9B;;;;;;;;;;;;;;;;OAgBG;IACU,SAAS;IAQtB;;OAEG;IACI,KAAK;IAKZ;;;;;;;;;;OAUG;IACU,OAAO;IAIpB;;OAEG;IACI,GAAG;IAIV;;;;;;;;;;;;;;OAcG;IACI,aAAa,CAAC,QAAQ,EAAE,MAAM,EAAE;IAIvC;;;;;;;;;;;;;;;;;;;OAmBG;IACI,UAAU,CAAC,IAAI,EAAE,oBAAoB;IAK5C;;;;;;;;;;;;;OAaG;IACI,kBAAkB,CAAC,SAAS,EAAE,MAAM,EAAE;IAI7C;;;;;;;;;;;;;OAaG;IACI,eAAe,CAAC,IAAI,EAAE,mBAAmB;IAIhD,SAAS,CAAC,cAAc,CAAC,OAAO,EAAE,oBAAoB,GAAG,uBAAuB;IAIhF,SAAS,CAAC,mBAAmB,CAAC,IAAI,EAAE,mBAAmB,GAAG,uBAAuB;CAGlF","file":"bleAdvertisement.d.ts","sourcesContent":["/**\n * @packageDocumentation\n * @module ObnizCore.Components.Ble.Hci\n */\nimport ObnizBLE from \"./ble\";\nimport Builder from \"./bleAdvertisementBuilder\";\nimport BleAdvertisementBuilder from \"./bleAdvertisementBuilder\";\nimport { BleAdvertisementData, BleScanResponseData, UUID } from \"./bleTypes\";\n\n/**\n * @category Use as Peripheral\n */\nexport default class BleAdvertisement {\n  protected obnizBle: ObnizBLE;\n  protected adv_data: number[];\n  protected scan_resp: number[];\n\n  constructor(obnizBle: ObnizBLE) {\n    this.obnizBle = obnizBle;\n    this.adv_data = [];\n    this.scan_resp = [];\n  }\n\n  /**\n   * This starts advertisement of BLE.\n   *\n   * Before calling this function, you should call [[setAdvData]] or [[setAdvDataRaw]] to set data.\n   * advertisement interval is 1.28sec fixed.\n   *\n   * ```javascript\n   * // Javascript Example\n   * await obniz.ble.initWait();\n   *   var service = new obniz.ble.service({\n   *  uuid : \"fff0\"\n   * });\n   * obniz.ble.peripheral.addService(service);\n   * obniz.ble.advertisement.setAdvData(service.advData);\n   * obniz.ble.advertisement.start();\n   * ```\n   */\n  public async startWait() {\n    this.obnizBle.warningIfNotInitialize();\n    await this.obnizBle.peripheralBindings.startAdvertisingWithEIRDataWait(\n      Buffer.from(this.adv_data),\n      Buffer.from(this.scan_resp),\n    );\n  }\n\n  /**\n   * @deprecated\n   */\n  public start() {\n    this.obnizBle.warningIfNotInitialize();\n    this.startWait(); // background\n  }\n\n  /**\n   * This stops advertisement of BLE.\n   *\n   * ```javascript\n   * // Javascript Example\n   * await obniz.ble.initWait();\n   * obniz.ble.advertisement.start();\n   * obniz.ble.advertisement.end();\n   * ```\n   *\n   */\n  public async endWait() {\n    await this.obnizBle.peripheralBindings.stopAdvertisingWait();\n  }\n\n  /**\n   *  @deprecated\n   */\n  public end() {\n    this.endWait(); // background\n  }\n\n  /**\n   * This sets advertise data from data array.\n   *\n   * ```javascript\n   * // Javascript Example\n   * await obniz.ble.initWait();\n   * obniz.ble.advertisement.setAdvDataRaw([0x02, 0x01, 0x1A, 0x07, 0x09, 0x53, 0x61, 0x6D, 0x70, 0x6C, 0x65 ]);\n   * //0x02, 0x01, 0x1A  => BLE type for\n   * //0x07, 0x09, 0x53, 0x61, 0x6D, 0x70, 0x6C, 0x65  => Set name\n   *\n   * obniz.ble.advertisement.start();\n   * ```\n   *\n   * @param adv_data\n   */\n  public setAdvDataRaw(adv_data: number[]) {\n    this.adv_data = adv_data;\n  }\n\n  /**\n   * This sets advertise data from json.\n   *\n   * ```javascript\n   * // Javascript Example\n   *\n   * await obniz.ble.initWait();\n   * obniz.ble.advertisement.setAdvData({\n   *   flags: [\"general_discoverable_mode\",\"br_edr_not_supported\"],\n   *   manufacturerData:{\n   *     companyCode : 0x004C,\n   *     serviceUuids: [\"fff0\"],\n   *     data : [0x02,0x15, 0xC2, 0x8f, 0x0a, 0xd5, 0xa7, 0xfd, 0x48, 0xbe, 0x9f, 0xd0, 0xea, 0xe9, 0xff, 0xd3, 0xa8, 0xbb,0x10,0x00,0x00,0x10,0xFF],\n   *   }\n   * });\n   *\n   * obniz.ble.advertisement.start();\n   * ```\n   * @param json\n   */\n  public setAdvData(json: BleAdvertisementData) {\n    const builder = this.advDataBulider(json);\n    this.setAdvDataRaw(builder.build());\n  }\n\n  /**\n   * This sets scan response data from data array.\n   *\n   * ```javascript\n   * // Javascript Example\n   * await obniz.ble.initWait();\n   * obniz.ble.advertisement.setScanRespDataRaw([0x07, 0x09, 0x53, 0x61, 0x6D, 0x70, 0x6C, 0x65 ]);\n   * //0x07, 0x09, 0x53, 0x61, 0x6D, 0x70, 0x6C, 0x65  => Set name\n   *\n   * obniz.ble.advertisement.start();\n   * ```\n   *\n   * @param scan_resp\n   */\n  public setScanRespDataRaw(scan_resp: number[]) {\n    this.scan_resp = scan_resp;\n  }\n\n  /**\n   * This sets scan response data from json data.\n   *\n   * ```javascript\n   * // Javascript Example\n   * await obniz.ble.initWait();\n   * obniz.ble.advertisement.setScanRespData({\n   *   localName : \"obniz BLE\",\n   * });\n   *\n   * obniz.ble.advertisement.start();\n   * ```\n   * @param json\n   */\n  public setScanRespData(json: BleScanResponseData) {\n    this.setScanRespDataRaw(this.scanRespDataBuilder(json).build());\n  }\n\n  protected advDataBulider(jsonVal: BleAdvertisementData): BleAdvertisementBuilder {\n    return new Builder(jsonVal);\n  }\n\n  protected scanRespDataBuilder(json: BleScanResponseData): BleAdvertisementBuilder {\n    return new Builder(json);\n  }\n}\n"]}