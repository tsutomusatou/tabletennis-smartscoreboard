{"version":3,"sources":["../src/obniz/libs/embeds/bleHci/bleRemoteService.ts"],"names":[],"mappings":";;;;;AAAA;;;GAGG;AACH,4DAAoC;AACpC,8FAAsE;AACtE,wFAAgE;AAIhE;;GAEG;AACH,MAAqB,gBAAiB,SAAQ,oCAAwE;IAMpH,YAAY,GAAQ;QAClB,KAAK,CAAC,GAAG,CAAC,CAAC;IACb,CAAC;IAED;;OAEG;IACH,IAAI,UAAU;QACZ,OAAO,YAAY,CAAC;IACtB,CAAC;IAED;;OAEG;IACH,IAAI,aAAa;QACf,OAAO,iCAAuB,CAAC;IACjC,CAAC;IAED;;OAEG;IACH,IAAI,YAAY;QACd,OAAO,iBAAiB,CAAC;IAC3B,CAAC;IAED;;;;;;;;;;;;;;;;;;;;;;;;;;;OA2BG;IACH,IAAI,eAAe;QACjB,OAAO,IAAI,CAAC,QAAQ,CAAC;IACvB,CAAC;IAED;;;OAGG;IACI,iBAAiB,CAAC,KAA+C;QACtE,OAAO,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;IAC9B,CAAC;IAED;;;;;;;;;;;;;;;;;;;;;;;;;;;;;OA6BG;IACI,iBAAiB,CAAC,IAAU;QACjC,OAAO,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;IAC7B,CAAC;IAED;;OAEG;IACI,0BAA0B;QAC/B,IAAI,CAAC,8BAA8B,EAAE,CAAC,CAAC,aAAa;IACtD,CAAC;IAED;;;;;;;;;;;;;;;;;;;;;;;;OAwBG;IACI,KAAK,CAAC,8BAA8B;QACzC,MAAM,KAAK,GAAG,MAAM,IAAI,CAAC,MAAO,CAAC,QAAQ,CAAC,eAAe,CAAC,2BAA2B,CACnF,IAAI,CAAC,UAAU,CAAC,OAAO,EACvB,IAAI,CAAC,IAAI,CACV,CAAC;QAEF,KAAK,MAAM,IAAI,IAAI,KAAK,EAAE;YACxB,MAAM,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC;YACvB,MAAM,UAAU,GAAG,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC,CAAM,EAAE,EAAE,CAAC,mBAAS,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,CAAC;YAC7E,IAAI,KAAK,GAAQ,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;YACrC,IAAI,CAAC,KAAK,EAAE;gBACV,KAAK,GAAG,IAAI,CAAC,QAAQ,CAAC,EAAE,IAAI,EAAE,CAAC,CAAC;aACjC;YACD,KAAK,CAAC,iBAAiB,GAAG,IAAI,CAAC;YAC/B,KAAK,CAAC,UAAU,GAAG,UAAU,IAAI,EAAE,CAAC;YACpC,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC;SACxB;QACD,OAAO,IAAI,CAAC,eAAe,CAAC,MAAM,CAAC,CAAC,GAAQ,EAAE,EAAE;YAC9C,OAAO,GAAG,CAAC,iBAAiB,CAAC;QAC/B,CAAC,CAAC,CAAC;IACL,CAAC;IAED;;;OAGG;IACI,UAAU,CAAC,cAAmB;QACnC,IAAI,CAAC,uBAAuB,CAAC,IAAI,CAAC,wBAAwB,EAAE,cAAc,CAAC,CAAC;IAC9E,CAAC;IAED;;;OAGG;IACI,kBAAkB,CAAC,eAAoB;QAC5C,IAAI,CAAC,uBAAuB,CAAC,IAAI,CAAC,gCAAgC,EAAE,eAAe,CAAC,CAAC;IACvF,CAAC;IAED;;;OAGG;IACI,wBAAwB,CAAC,cAAmB,IAAG,CAAC;IAEvD;;;OAGG;IACI,gCAAgC,CAAC,eAAsB,IAAG,CAAC;IAElE;;OAEG;IACI,KAAK,CAAC,QAAQ;QACnB,MAAM,IAAI,KAAK,CAAC,qBAAqB,CAAC,CAAC;IACzC,CAAC;IAED;;OAEG;IACI,KAAK,CAAC,SAAS;QACpB,MAAM,IAAI,KAAK,CAAC,sBAAsB,CAAC,CAAC;IAC1C,CAAC;CACF;AAxMD,mCAwMC","file":"bleRemoteService.js","sourcesContent":["/**\n * @packageDocumentation\n * @module ObnizCore.Components.Ble.Hci\n */\nimport BleHelper from \"./bleHelper\";\nimport BleRemoteAttributeAbstract from \"./bleRemoteAttributeAbstract\";\nimport BleRemoteCharacteristic from \"./bleRemoteCharacteristic\";\nimport BleRemotePeripheral from \"./bleRemotePeripheral\";\nimport { UUID } from \"./bleTypes\";\n\n/**\n * @category Use as Central\n */\nexport default class BleRemoteService extends BleRemoteAttributeAbstract<BleRemotePeripheral, BleRemoteCharacteristic> {\n  /**\n   * Peripheral instance\n   */\n  public peripheral!: BleRemotePeripheral;\n\n  constructor(obj: any) {\n    super(obj);\n  }\n\n  /**\n   * @ignore\n   */\n  get parentName(): string | null {\n    return \"peripheral\";\n  }\n\n  /**\n   * @ignore\n   */\n  get childrenClass(): any {\n    return BleRemoteCharacteristic;\n  }\n\n  /**\n   * @ignore\n   */\n  get childrenName(): string | null {\n    return \"characteristics\";\n  }\n\n  /**\n   * It contains characteristics in a service.\n   * It was discovered when connection automatically.\n   *\n   * ```javascript\n   * // Javascript Example\n   *\n   * await obniz.ble.initWait();\n   * var target = {\n   *     uuids: [\"fff0\"],\n   * };\n   * var peripheral = await obniz.ble.scan.startOneWait(target);\n   *  if(!peripheral) {\n   *     console.log('no such peripheral')\n   *     return;\n   * }\n   * try {\n   *   await peripheral.connectWait();\n   *   console.log(\"connected\");\n   *   var service = peripheral.getService(\"1800\")\n   *   for (var c of service.characteristics) {\n   *     console.log(c.uuid)\n   *   }\n   * } catch(e) {\n   *   console.error(e);\n   * }\n   * ```\n   */\n  get characteristics(): BleRemoteCharacteristic[] {\n    return this.children;\n  }\n\n  /**\n   * @ignore\n   * @param param\n   */\n  public addCharacteristic(param: { uuid: UUID } | BleRemoteCharacteristic) {\n    return this.addChild(param);\n  }\n\n  /**\n   * It returns a characteristic which having specified uuid in a service.\n   * Return value is null when not matched.\n   *\n   * Case is ignored. So aa00 and AA00 are the same.\n   *\n   * ```javascript\n   * // Javascript Example\n   *\n   * await obniz.ble.initWait();\n   * var target = {\n   *   uuids: [\"fff0\"],\n   * };\n   * var peripheral = await obniz.ble.scan.startOneWait(target);\n   * if(!peripheral) {\n   *    console.log('no such peripheral')\n   *     return;\n   * }\n   * try {\n   *   await peripheral.connectWait();\n   *   console.log(\"connected\");\n   *   var service = peripheral.getService(\"1800\")\n   *   var c = service.getCharacteristic(\"fff0\")\n   *   console.log(c.uuid)\n   * } catch(e) {\n   *   console.error(e);\n   * }\n   * ```\n   * @param uuid\n   */\n  public getCharacteristic(uuid: UUID): BleRemoteCharacteristic | null {\n    return this.getChild(uuid);\n  }\n\n  /**\n   * @ignore\n   */\n  public discoverAllCharacteristics() {\n    this.discoverAllCharacteristicsWait(); // background\n  }\n\n  /**\n   * Discover services.\n   *\n   * If connect setting param 'autoDiscovery' is true(default),\n   * services are automatically disvocer on connection established.\n   *\n   *\n   * ```javascript\n   * // Javascript Example\n   * await obniz.ble.initWait({});\n   * obniz.ble.scan.onfind = function(peripheral){\n   * if(peripheral.localName == \"my peripheral\"){\n   *      peripheral.onconnect = async function(){\n   *          console.log(\"success\");\n   *          await peripheral.discoverAllServicesWait(); //manually discover\n   *          let service = peripheral.getService(\"1800\");\n   *          await service.discoverAllCharacteristicsWait(); //manually discover\n   *          let characteristics = service.getCharacteristic(\"ff00\")\n   *      }\n   *      peripheral.connect({autoDiscovery:false});\n   *     }\n   * }\n   * await obniz.ble.scan.startWait();\n   * ```\n   */\n  public async discoverAllCharacteristicsWait(): Promise<BleRemoteCharacteristic[]> {\n    const chars = await this.parent!.obnizBle.centralBindings.discoverCharacteristicsWait(\n      this.peripheral.address,\n      this.uuid,\n    );\n\n    for (const char of chars) {\n      const uuid = char.uuid;\n      const properties = char.properties.map((e: any) => BleHelper.toSnakeCase(e));\n      let child: any = this.getChild(uuid);\n      if (!child) {\n        child = this.addChild({ uuid });\n      }\n      child.discoverdOnRemote = true;\n      child.properties = properties || [];\n      this.ondiscover(child);\n    }\n    return this.characteristics.filter((elm: any) => {\n      return elm.discoverdOnRemote;\n    });\n  }\n\n  /**\n   * @ignore\n   * @param characteristic\n   */\n  public ondiscover(characteristic: any) {\n    this._runUserCreatedFunction(this.ondiscovercharacteristic, characteristic);\n  }\n\n  /**\n   * @ignore\n   * @param characteristics\n   */\n  public ondiscoverfinished(characteristics: any) {\n    this._runUserCreatedFunction(this.ondiscovercharacteristicfinished, characteristics);\n  }\n\n  /**\n   * @ignore\n   * @param characteristic\n   */\n  public ondiscovercharacteristic(characteristic: any) {}\n\n  /**\n   * @ignore\n   * @param characteristics\n   */\n  public ondiscovercharacteristicfinished(characteristics: any[]) {}\n\n  /**\n   * @ignore\n   */\n  public async readWait(): Promise<number[]> {\n    throw new Error(\"cannot read service\");\n  }\n\n  /**\n   * @ignore\n   */\n  public async writeWait(): Promise<boolean> {\n    throw new Error(\"cannot write service\");\n  }\n}\n"]}