{"version":3,"sources":["../src/obniz/libs/embeds/bleHci/bleAdvertisement.ts"],"names":[],"mappings":";;;;;AAKA,wFAAgD;AAIhD;;GAEG;AACH,MAAqB,gBAAgB;IAKnC,YAAY,QAAkB;QAC5B,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;QACzB,IAAI,CAAC,QAAQ,GAAG,EAAE,CAAC;QACnB,IAAI,CAAC,SAAS,GAAG,EAAE,CAAC;IACtB,CAAC;IAED;;;;;;;;;;;;;;;;OAgBG;IACI,KAAK,CAAC,SAAS;QACpB,IAAI,CAAC,QAAQ,CAAC,sBAAsB,EAAE,CAAC;QACvC,MAAM,IAAI,CAAC,QAAQ,CAAC,kBAAkB,CAAC,+BAA+B,CACpE,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,EAC1B,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,CAC5B,CAAC;IACJ,CAAC;IAED;;OAEG;IACI,KAAK;QACV,IAAI,CAAC,QAAQ,CAAC,sBAAsB,EAAE,CAAC;QACvC,IAAI,CAAC,SAAS,EAAE,CAAC,CAAC,aAAa;IACjC,CAAC;IAED;;;;;;;;;;OAUG;IACI,KAAK,CAAC,OAAO;QAClB,MAAM,IAAI,CAAC,QAAQ,CAAC,kBAAkB,CAAC,mBAAmB,EAAE,CAAC;IAC/D,CAAC;IAED;;OAEG;IACI,GAAG;QACR,IAAI,CAAC,OAAO,EAAE,CAAC,CAAC,aAAa;IAC/B,CAAC;IAED;;;;;;;;;;;;;;OAcG;IACI,aAAa,CAAC,QAAkB;QACrC,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;IAC3B,CAAC;IAED;;;;;;;;;;;;;;;;;;;OAmBG;IACI,UAAU,CAAC,IAA0B;QAC1C,MAAM,OAAO,GAAG,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,CAAC;QAC1C,IAAI,CAAC,aAAa,CAAC,OAAO,CAAC,KAAK,EAAE,CAAC,CAAC;IACtC,CAAC;IAED;;;;;;;;;;;;;OAaG;IACI,kBAAkB,CAAC,SAAmB;QAC3C,IAAI,CAAC,SAAS,GAAG,SAAS,CAAC;IAC7B,CAAC;IAED;;;;;;;;;;;;;OAaG;IACI,eAAe,CAAC,IAAyB;QAC9C,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,mBAAmB,CAAC,IAAI,CAAC,CAAC,KAAK,EAAE,CAAC,CAAC;IAClE,CAAC;IAES,cAAc,CAAC,OAA6B;QACpD,OAAO,IAAI,iCAAO,CAAC,OAAO,CAAC,CAAC;IAC9B,CAAC;IAES,mBAAmB,CAAC,IAAyB;QACrD,OAAO,IAAI,iCAAO,CAAC,IAAI,CAAC,CAAC;IAC3B,CAAC;CACF;AAzJD,mCAyJC","file":"bleAdvertisement.js","sourcesContent":["/**\n * @packageDocumentation\n * @module ObnizCore.Components.Ble.Hci\n */\nimport ObnizBLE from \"./ble\";\nimport Builder from \"./bleAdvertisementBuilder\";\nimport BleAdvertisementBuilder from \"./bleAdvertisementBuilder\";\nimport { BleAdvertisementData, BleScanResponseData, UUID } from \"./bleTypes\";\n\n/**\n * @category Use as Peripheral\n */\nexport default class BleAdvertisement {\n  protected obnizBle: ObnizBLE;\n  protected adv_data: number[];\n  protected scan_resp: number[];\n\n  constructor(obnizBle: ObnizBLE) {\n    this.obnizBle = obnizBle;\n    this.adv_data = [];\n    this.scan_resp = [];\n  }\n\n  /**\n   * This starts advertisement of BLE.\n   *\n   * Before calling this function, you should call [[setAdvData]] or [[setAdvDataRaw]] to set data.\n   * advertisement interval is 1.28sec fixed.\n   *\n   * ```javascript\n   * // Javascript Example\n   * await obniz.ble.initWait();\n   *   var service = new obniz.ble.service({\n   *  uuid : \"fff0\"\n   * });\n   * obniz.ble.peripheral.addService(service);\n   * obniz.ble.advertisement.setAdvData(service.advData);\n   * obniz.ble.advertisement.start();\n   * ```\n   */\n  public async startWait() {\n    this.obnizBle.warningIfNotInitialize();\n    await this.obnizBle.peripheralBindings.startAdvertisingWithEIRDataWait(\n      Buffer.from(this.adv_data),\n      Buffer.from(this.scan_resp),\n    );\n  }\n\n  /**\n   * @deprecated\n   */\n  public start() {\n    this.obnizBle.warningIfNotInitialize();\n    this.startWait(); // background\n  }\n\n  /**\n   * This stops advertisement of BLE.\n   *\n   * ```javascript\n   * // Javascript Example\n   * await obniz.ble.initWait();\n   * obniz.ble.advertisement.start();\n   * obniz.ble.advertisement.end();\n   * ```\n   *\n   */\n  public async endWait() {\n    await this.obnizBle.peripheralBindings.stopAdvertisingWait();\n  }\n\n  /**\n   *  @deprecated\n   */\n  public end() {\n    this.endWait(); // background\n  }\n\n  /**\n   * This sets advertise data from data array.\n   *\n   * ```javascript\n   * // Javascript Example\n   * await obniz.ble.initWait();\n   * obniz.ble.advertisement.setAdvDataRaw([0x02, 0x01, 0x1A, 0x07, 0x09, 0x53, 0x61, 0x6D, 0x70, 0x6C, 0x65 ]);\n   * //0x02, 0x01, 0x1A  => BLE type for\n   * //0x07, 0x09, 0x53, 0x61, 0x6D, 0x70, 0x6C, 0x65  => Set name\n   *\n   * obniz.ble.advertisement.start();\n   * ```\n   *\n   * @param adv_data\n   */\n  public setAdvDataRaw(adv_data: number[]) {\n    this.adv_data = adv_data;\n  }\n\n  /**\n   * This sets advertise data from json.\n   *\n   * ```javascript\n   * // Javascript Example\n   *\n   * await obniz.ble.initWait();\n   * obniz.ble.advertisement.setAdvData({\n   *   flags: [\"general_discoverable_mode\",\"br_edr_not_supported\"],\n   *   manufacturerData:{\n   *     companyCode : 0x004C,\n   *     serviceUuids: [\"fff0\"],\n   *     data : [0x02,0x15, 0xC2, 0x8f, 0x0a, 0xd5, 0xa7, 0xfd, 0x48, 0xbe, 0x9f, 0xd0, 0xea, 0xe9, 0xff, 0xd3, 0xa8, 0xbb,0x10,0x00,0x00,0x10,0xFF],\n   *   }\n   * });\n   *\n   * obniz.ble.advertisement.start();\n   * ```\n   * @param json\n   */\n  public setAdvData(json: BleAdvertisementData) {\n    const builder = this.advDataBulider(json);\n    this.setAdvDataRaw(builder.build());\n  }\n\n  /**\n   * This sets scan response data from data array.\n   *\n   * ```javascript\n   * // Javascript Example\n   * await obniz.ble.initWait();\n   * obniz.ble.advertisement.setScanRespDataRaw([0x07, 0x09, 0x53, 0x61, 0x6D, 0x70, 0x6C, 0x65 ]);\n   * //0x07, 0x09, 0x53, 0x61, 0x6D, 0x70, 0x6C, 0x65  => Set name\n   *\n   * obniz.ble.advertisement.start();\n   * ```\n   *\n   * @param scan_resp\n   */\n  public setScanRespDataRaw(scan_resp: number[]) {\n    this.scan_resp = scan_resp;\n  }\n\n  /**\n   * This sets scan response data from json data.\n   *\n   * ```javascript\n   * // Javascript Example\n   * await obniz.ble.initWait();\n   * obniz.ble.advertisement.setScanRespData({\n   *   localName : \"obniz BLE\",\n   * });\n   *\n   * obniz.ble.advertisement.start();\n   * ```\n   * @param json\n   */\n  public setScanRespData(json: BleScanResponseData) {\n    this.setScanRespDataRaw(this.scanRespDataBuilder(json).build());\n  }\n\n  protected advDataBulider(jsonVal: BleAdvertisementData): BleAdvertisementBuilder {\n    return new Builder(jsonVal);\n  }\n\n  protected scanRespDataBuilder(json: BleScanResponseData): BleAdvertisementBuilder {\n    return new Builder(json);\n  }\n}\n"]}