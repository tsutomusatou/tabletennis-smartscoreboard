{"version":3,"sources":["../src/obniz/ObnizApi.ts"],"names":[],"mappings":"AAAA;;;GAGG;AAMH,OAAO,EAAE,YAAY,EAAE,MAAM,gBAAgB,CAAC;AAE9C,MAAM,CAAC,OAAO,OAAO,QAAQ;IAC3B;;OAEG;IACH,IAAI,UAAU,IAAI,MAAM,CAGvB;IAEM,OAAO,EAAE,GAAG,CAAC;IACb,OAAO,EAAE,GAAG,CAAC;IACpB,OAAO,CAAC,EAAE,CAAS;gBAEP,OAAO,EAAE,MAAM,EAAE,OAAO,CAAC,EAAE,YAAY;IAUnD;;;OAGG;IACI,QAAQ,CAAC,QAAQ,EAAE,CAAC,GAAG,EAAE;QAAE,KAAK,EAAE,QAAQ,GAAG,SAAS,CAAA;KAAE,KAAK,IAAI;IAIxE;;;;OAIG;IACI,QAAQ,CAAC,IAAI,EAAE,GAAG,EAAE,QAAQ,EAAE,CAAC,MAAM,EAAE,GAAG,KAAK,IAAI;IAI1D,SAAS,CAAC,IAAI,CAAC,IAAI,EAAE,GAAG,EAAE,MAAM,EAAE,GAAG,EAAE,QAAQ,EAAE,GAAG;CAoCrD","file":"ObnizApi.d.ts","sourcesContent":["/**\n * @packageDocumentation\n * @module ObnizCore\n */\n\nimport fetch from \"node-fetch\";\n\n// @ts-ignore\nimport packageJson from \"../../package\";\nimport { ObnizOptions } from \"./ObnizOptions\"; // pakcage.js will be created from package.json on build.\n\nexport default class ObnizApi {\n  /**\n   * obniz.js major version string\n   */\n  get apiVersion(): string {\n    const versionString: any = packageJson.version;\n    return versionString.split(\".\").shift();\n  }\n\n  public options: any;\n  public urlBase: any;\n  private id: string;\n\n  constructor(obnizId: string, options?: ObnizOptions) {\n    this.id = obnizId;\n    options = options || {};\n    this.options = {\n      access_token: options.access_token || null,\n      obniz_server: options.obniz_server || \"https://obniz.io\",\n    };\n    this.urlBase = this.options.obniz_server + \"/obniz/\" + this.id;\n  }\n\n  /**\n   * Get device is online or offline\n   * @param callback with result\n   */\n  public getState(callback: (val: { state: \"online\" | \"offline\" }) => void) {\n    return this.post(\"/state\", null, callback);\n  }\n\n  /**\n   * post data via obniz REST api\n   * @param json\n   * @param callback\n   */\n  public postJson(json: any, callback: (result: any) => void) {\n    return this.post(\"/api/\" + this.apiVersion, json, callback); // 1 is api version\n  }\n\n  protected post(path: any, params: any, callback: any) {\n    const url: any = this.urlBase + path;\n\n    // let query = [];\n    // query.push(\"XXX\");\n    // if(query.length > 0){\n    //   url += \"?\" + query.join(\"&\");\n    // }\n\n    const headers: any = {};\n    headers[\"Content-Type\"] = \"application/json\";\n    if (this.options.access_token) {\n      headers.authorization = \"Bearer \" + this.options.access_token;\n    }\n\n    const fetchParams: any = {\n      method: \"POST\",\n      headers,\n    };\n    if (params) {\n      fetchParams.body = JSON.stringify(params);\n    }\n\n    return fetch(url, fetchParams)\n      .then((res: any) => {\n        return res.json();\n      })\n      .then((json: any) => {\n        if (typeof callback === \"function\") {\n          callback(json);\n        }\n        return new Promise((resolve: any) => {\n          resolve(json);\n        });\n      });\n  }\n}\n"]}