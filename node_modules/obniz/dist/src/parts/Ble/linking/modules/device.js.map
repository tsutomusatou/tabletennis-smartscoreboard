{"version":3,"sources":["../src/parts/Ble/linking/modules/device.ts"],"names":[],"mappings":"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","file":"device.js","sourcesContent":["/**\n * @packageDocumentation\n * @module Parts.Linking\n */\n\n/* ------------------------------------------------------------------\n * node-linking - device.js\n *\n * Copyright (c) 2017-2019, Futomi Hatano, All rights reserved.\n * Released under the MIT license\n * Date: 2019-11-03\n * ---------------------------------------------------------------- */\n\"use strict\";\nimport BleRemoteCharacteristic from \"../../../../obniz/libs/embeds/bleHci/bleRemoteCharacteristic\";\nimport BleRemotePeripheral from \"../../../../obniz/libs/embeds/bleHci/bleRemotePeripheral\";\nimport LinkingAdvertising from \"./advertising\";\nimport LinkingService from \"./service\";\n\nexport default class LinkingDevice {\n  public PRIMARY_SERVICE_UUID = \"b3b3690150d34044808d50835b13a6cd\";\n  public WRITE_CHARACTERRISTIC_UUID = \"b3b3910150d34044808d50835b13a6cd\";\n  public INDICATE_CHARACTERRISTIC_UUID = \"b3b3910250d34044808d50835b13a6cd\";\n  public info: any = {};\n  public advertisement: any;\n  public connected = false;\n  public onconnect: any = null;\n  public onconnectprogress: any = null;\n  public ondisconnect: any = null;\n  public onnotify: any = null;\n  public services: any = {\n    deviceName: null,\n    led: null,\n    vibration: null,\n    button: null,\n    gyroscope: null,\n    accelerometer: null,\n    orientation: null,\n    battery: null,\n    temperature: null,\n    humidity: null,\n    pressure: null,\n    openclose: null,\n    human: null,\n    move: null,\n    illuminance: null,\n  };\n\n  private _peripheral!: BleRemotePeripheral;\n  private _service: any = null;\n  private char_write!: BleRemoteCharacteristic | null;\n  private char_indicate!: BleRemoteCharacteristic | null;\n  private _div_packet_queue: any = [];\n  private _LinkingService = new LinkingService();\n  private _onresponse: any = null;\n  private _write_response_timeout: any = 30000; // msec\n  private _generic_access_service: any = {\n    SERVICE_UUID: \"1800\",\n    service: null,\n    device_name: {\n      CHARACTERRISTIC_UUID: \"2a00\",\n      char: null,\n    },\n  };\n\n  constructor(peripheral: BleRemotePeripheral) {\n    this.advertisement = LinkingAdvertising.parse(peripheral);\n\n    this._peripheral = peripheral;\n  }\n\n  public async connect() {\n    if (this.connected === true) {\n      throw new Error(\"The device has been already connected.\");\n    }\n    let onprogress = this.onconnectprogress;\n    if (!this._isFunction(this.onconnectprogress)) {\n      onprogress = () => {};\n    }\n    const peripheral = this._peripheral;\n    onprogress({ step: 1, desc: \"CONNECTING\" });\n    try {\n      peripheral.ondisconnect = async () => {\n        await this._clean();\n        if (this._isFunction(this.ondisconnect)) {\n          this.ondisconnect({ wasClean: false });\n        }\n      };\n      await peripheral.connectWait();\n      onprogress({ step: 2, desc: \"CONNECTION_ESTABLISHED\" });\n      onprogress({ step: 3, desc: \"GETTING_CHARACTERISTICS\" });\n      await this._getServicesAndChars();\n      onprogress({ step: 4, desc: \"SUBSCRIBING\" });\n      await this._subscribeForIndicate();\n      onprogress({ step: 5, desc: \"GETTING_DEVICE_INFOMATION\" });\n      let res: any;\n      res = await this.write(\"GET_DEVICE_INFORMATION\");\n      this.info.id = \"\";\n      if (\"deviceId\" in res.data) {\n        this.info.id = res.data.deviceId;\n      }\n      this.info.uid = \"\";\n      if (\"deviceUid\" in res.data) {\n        this.info.uid = res.data.deviceUid;\n      }\n      this.info.services = {};\n      if (\"serviceList\" in res.data) {\n        res.data.serviceList.forEach((o: any) => {\n          this.info.services[o.name] = o.id;\n        });\n      }\n      this.info.capabilities = {};\n      if (\"deviceCapability\" in res.data) {\n        res.data.deviceCapability.forEach((o: any) => {\n          this.info.capabilities[o.name] = o.id;\n        });\n      }\n      this.info.exsensors = {};\n      if (\"exSensorType\" in res.data) {\n        res.data.exSensorType.forEach((o: any) => {\n          this.info.exsensors[o.name] = o.id;\n        });\n      }\n      onprogress({ step: 6, desc: \"GETTING_NOTIFY_CATEGORIES\" });\n      res = await this._writeConfirmNotifyCategory();\n      this.info.notifyCategories = {};\n      if (res) {\n        if (\"notifyCategory\" in res.data) {\n          res.data.notifyCategory.forEach((o: any) => {\n            this.info.notifyCategories[o.name] = o.id;\n          });\n        }\n      }\n      onprogress({ step: 7, desc: \"GETTING_SETTING_INFORMATION\" });\n      res = await this._writeGetSettingInformation();\n      this.info.settings = {};\n      if (res) {\n        if (\"settingInformationData\" in res.data) {\n          res.data.settingInformationData.forEach((o: any) => {\n            this.info.settings[o.name] = o;\n          });\n        }\n      }\n      onprogress({ step: 8, desc: \"GETTING_LED_COLOR_NAMES\" });\n      res = await this._writeGetSettingName(\"LEDColorName\");\n      if (res) {\n        this.info.settings.LED.colors = res.data.settingNameData;\n      }\n      onprogress({ step: 9, desc: \"GETTING_LED_PATTERN_NAMES\" });\n      res = await this._writeGetSettingName(\"LEDPatternName\");\n      if (res) {\n        this.info.settings.LED.patterns = res.data.settingNameData;\n      }\n      onprogress({ step: 10, desc: \"GETTING_VIBRATION_PATTERN_NAMES\" });\n      res = await this._writeGetSettingName(\"VibrationPatternName\");\n      if (res) {\n        this.info.settings.Vibration.patterns = res.data.settingNameData;\n      }\n      onprogress({ step: 11, desc: \"GETTING_BEEP_PATTERN_NAMES\" });\n      res = await this._writeGetSettingName(\"BeepPatternName\");\n      if (res) {\n        this.info.settings.Beep.patterns = res.data.settingNameData;\n      }\n      this._LinkingService.setDeviceInfo(this.info);\n      this._initServices();\n\n      this.connected = true;\n      if (this._isFunction(this.onconnect)) {\n        this.onconnect();\n      }\n\n      onprogress({ step: 12, desc: \"COMPLETED\" });\n    } catch (e) {\n      onprogress({ step: 0, desc: \"FAILED\" });\n      throw e;\n    }\n  }\n\n  public _wait(msec: number) {\n    const promise = new Promise((resolve, reject) => {\n      setTimeout(() => {\n        resolve();\n      }, msec);\n    });\n    return promise;\n  }\n\n  public _writeConfirmNotifyCategory() {\n    const promise = new Promise((resolve, reject) => {\n      if (!(\"PeripheralDeviceNotification\" in this.info.services)) {\n        resolve(null);\n        return;\n      }\n      this.write(\"CONFIRM_NOTIFY_CATEGORY\")\n        .then((res: any) => {\n          resolve(res);\n        })\n        .catch((error) => {\n          reject(error);\n        });\n    });\n    return promise;\n  }\n\n  public _writeGetSettingInformation() {\n    const promise = new Promise((resolve, reject) => {\n      if (!(\"PeripheralDeviceSettingOperation\" in this.info.services)) {\n        resolve(null);\n        return;\n      }\n      this.write(\"GET_SETTING_INFORMATION\")\n        .then((res: any) => {\n          resolve(res);\n        })\n        .catch((error: any) => {\n          reject(error);\n        });\n    });\n    return promise;\n  }\n\n  public _writeGetSettingName(name: string) {\n    const promise = new Promise((resolve, reject) => {\n      if (!(\"PeripheralDeviceSettingOperation\" in this.info.services)) {\n        resolve(null);\n        return;\n      }\n\n      const s = this.info.settings;\n      if (name === \"LEDColorName\") {\n        if (!(\"LED\" in s && s.LED.colorMax)) {\n          resolve(null);\n          return;\n        }\n      } else if (name === \"LEDPatternName\") {\n        if (!(\"LED\" in s && s.LED.patternMax)) {\n          resolve(null);\n          return;\n        }\n      } else if (name === \"VibrationPatternName\") {\n        if (!(\"Vibration\" in s && s.Vibration.patternMax)) {\n          resolve(null);\n          return;\n        }\n      } else if (name === \"BeepPatternName\") {\n        if (!(\"Beep\" in s && s.Beep.patternMax)) {\n          resolve(null);\n          return;\n        }\n      }\n      this.write(\"GET_SETTING_NAME\", { SettingNameType: name })\n        .then((res) => {\n          resolve(res);\n        })\n        .catch((error) => {\n          reject(error);\n        });\n    });\n    return promise;\n  }\n\n  public _isFunction(o: any) {\n    return o && typeof o === \"function\" ? true : false;\n  }\n\n  public _getServicesAndChars() {\n    const peripheral = this._peripheral;\n    const service = peripheral.getService(this.PRIMARY_SERVICE_UUID);\n    if (!service) {\n      throw new Error(\"No service was found\");\n    }\n    const write_char = service.getCharacteristic(this.WRITE_CHARACTERRISTIC_UUID);\n    const indicate_char = service.getCharacteristic(this.INDICATE_CHARACTERRISTIC_UUID);\n    if (!(write_char && indicate_char)) {\n      throw new Error(\"No characteristic was found\");\n    }\n    this.char_write = write_char;\n    this.char_indicate = indicate_char;\n    this._service = service;\n\n    const ga_service = peripheral.getService(this._generic_access_service.SERVICE_UUID);\n    if (ga_service) {\n      const ga_char = ga_service.getCharacteristic(this._generic_access_service.device_name.CHARACTERRISTIC_UUID);\n      if (ga_service && ga_char) {\n        this._generic_access_service.service = ga_service;\n        this._generic_access_service.device_name.char = ga_char;\n      }\n    }\n  }\n\n  public async _subscribeForIndicate() {\n    await this.char_indicate!.registerNotifyWait((data: number[]) => {\n      this._receivedPacket(Buffer.from(data));\n    });\n  }\n\n  public _receivedPacket(buf: any) {\n    const new_buf = Buffer.alloc(buf.length - 1);\n    buf.copy(new_buf, 0, 1, buf.length);\n    this._div_packet_queue.push(new_buf);\n    if (this._isExecutedPacket(buf)) {\n      const header_byte = Buffer.from([buf.readUInt8(0)]);\n      this._div_packet_queue.unshift(header_byte);\n      const total_buf = Buffer.concat(this._div_packet_queue);\n      this._receivedIndicate(total_buf);\n      this._div_packet_queue = [];\n    }\n  }\n\n  public _isExecutedPacket(buf: any) {\n    const ph = buf.readUInt8(0);\n    return ph & 0x00000001 ? true : false;\n  }\n\n  public _receivedIndicate(buf: any) {\n    const parsed = this._LinkingService.parseResponse(buf);\n    if (!parsed) {\n      return;\n    }\n    if (parsed.messageName.match(/_RESP$/)) {\n      if (this._onresponse) {\n        this._onresponse(parsed);\n      }\n    } else {\n      // All notifications\n      if (this._isFunction(this.onnotify)) {\n        this.onnotify(parsed);\n      }\n      // Button\n      if (parsed.serviceId === 2) {\n        // PeripheralDeviceOperation Service\n        if (parsed.messageId === 0) {\n          // NOTIFY_PD_OPERATION\n          // let f = this.services['button']['onnotify'];\n          let f = null;\n          if (this.services.button) {\n            if (this._isFunction(this.services.button.onnotify)) {\n              f = this.services.button.onnotify;\n            }\n          }\n          if (f) {\n            let button = null;\n            parsed.parameters.forEach((p: any) => {\n              if (p.parameterId === 2) {\n                // ButtonId\n                button = {\n                  buttonId: p.buttonId,\n                  buttonName: p.buttonName,\n                };\n              }\n            });\n            f(button);\n          }\n        }\n        // Sensors\n      } else if (parsed.serviceId === 3) {\n        // PeripheralDeviceSensorInformation Service\n        if (parsed.messageId === 4) {\n          // NOTIFY_PD_SENSOR_INFO\n          let sensor_type = -1;\n          let res: any = {};\n          parsed.parameters.forEach((p: any) => {\n            const pid = p.parameterId;\n            if (pid === 2) {\n              // SensorType\n              sensor_type = p.sensorTypeCode;\n            } else {\n              if (sensor_type.toString().match(/^(0|1|2)$/)) {\n                // Gyroscope, Accelerometer, Orientation\n                if (pid === 4) {\n                  // X_value\n                  res.x = p.xValue;\n                } else if (pid === 5) {\n                  // Y_value\n                  res.y = p.yValue;\n                } else if (pid === 6) {\n                  // Z_value\n                  res.z = p.zValue;\n                }\n              } else if (sensor_type === 3) {\n                // Battery\n                res = {\n                  charge: p.charge,\n                  level: p.level,\n                };\n              } else if (sensor_type === 4) {\n                // Temperature\n                res.temperature = p.temperature;\n              } else if (sensor_type === 5) {\n                // Humidity\n                res.humidity = p.humidity;\n              } else if (sensor_type === 6) {\n                // Aire pressure\n                res.pressure = p.pressure;\n              } else if (sensor_type === 7) {\n                // Opening and closing\n                res.openclose = p.openclose;\n              } else if (sensor_type === 8) {\n                // Human detection\n                res.human = p.human;\n              } else if (sensor_type === 9) {\n                // Move\n                res.move = p.move;\n              } else if (sensor_type === 0x0a) {\n                // Illuminance\n                res.illuminance = p.illuminance;\n              }\n            }\n          });\n\n          let f = null;\n          if (sensor_type === 0) {\n            if (this.services.gyroscope) {\n              f = this.services.gyroscope.onnotify;\n            }\n          } else if (sensor_type === 1) {\n            if (this.services.accelerometer) {\n              f = this.services.accelerometer.onnotify;\n            }\n          } else if (sensor_type === 2) {\n            if (this.services.orientation) {\n              f = this.services.orientation.onnotify;\n            }\n          } else if (sensor_type === 3) {\n            if (this.services.battery) {\n              f = this.services.battery.onnotify;\n            }\n          } else if (sensor_type === 4) {\n            if (this.services.temperature) {\n              f = this.services.temperature.onnotify;\n            }\n          } else if (sensor_type === 5) {\n            if (this.services.humidity) {\n              f = this.services.humidity.onnotify;\n            }\n          } else if (sensor_type === 6) {\n            if (this.services.pressure) {\n              f = this.services.pressure.onnotify;\n            }\n          } else if (sensor_type === 7) {\n            if (this.services.openclose) {\n              f = this.services.openclose.onnotify;\n            }\n          } else if (sensor_type === 8) {\n            if (this.services.human) {\n              f = this.services.human.onnotify;\n            }\n          } else if (sensor_type === 9) {\n            if (this.services.move) {\n              f = this.services.move.onnotify;\n            }\n          } else if (sensor_type === 0x0a) {\n            if (this.services.illuminance) {\n              f = this.services.illuminance.onnotify;\n            }\n          }\n\n          if (this._isFunction(f)) {\n            f(res);\n          }\n        }\n      }\n    }\n  }\n\n  public async disconnect() {\n    if (this.connected === false) {\n      await this._clean();\n      return;\n    }\n    await this._peripheral.disconnectWait();\n    if (this._isFunction(this.ondisconnect)) {\n      this.ondisconnect({ wasClean: true });\n    }\n  }\n\n  public async _clean() {\n    const p = this._peripheral;\n    if (!p) {\n      return;\n    }\n    if (this.char_indicate) {\n      await this.char_indicate.unregisterNotifyWait();\n    }\n    // p.removeAllListeners();\n    this.connected = false;\n    this._service = null;\n    this.char_write = null;\n    this.char_indicate = null;\n    this._div_packet_queue = [];\n    this._onresponse = null;\n  }\n\n  public write(message_name: any, params?: any) {\n    return new Promise(async (resolve, reject) => {\n      const buf = this._LinkingService.createRequest(message_name, params);\n      if (!buf) {\n        reject(new Error(\"The specified parameters are invalid.\"));\n      }\n\n      const timer = setTimeout(() => {\n        this._onresponse = null;\n        reject(new Error(\"Timeout\"));\n      }, this._write_response_timeout);\n\n      this._onresponse = (res: any) => {\n        if (res.messageName === message_name + \"_RESP\") {\n          this._onresponse = null;\n          clearTimeout(timer);\n          const data = this._margeResponsePrameters(res);\n          if (data) {\n            res.data = data;\n            resolve(res);\n          } else {\n            reject(new Error(\"Unknown response\"));\n          }\n        }\n      };\n\n      try {\n        await this.char_write!.writeWait(buf, true);\n      } catch (e) {\n        reject(e);\n      }\n    });\n  }\n\n  public _margeResponsePrameters(res: any) {\n    if (!res) {\n      return null;\n    }\n    const parameters = res.parameters;\n    if (parameters && Array.isArray(parameters) && parameters.length > 0) {\n      const data: any = {};\n      parameters.forEach((p) => {\n        for (const k in p) {\n          if (!k.match(/^(name|parameterId)$/)) {\n            data[k] = p[k];\n          }\n        }\n      });\n      return data;\n    } else {\n      return null;\n    }\n  }\n\n  public _initServices() {\n    const device_name = this._peripheral.localName || \"\";\n    // Device Name\n    if (this._generic_access_service.device_name.char) {\n      this.services.deviceName = {\n        get: this._deviceNameGet.bind(this),\n        set: this._deviceNameSet.bind(this),\n      };\n    }\n    // Button\n    if (\"Button\" in this.info.exsensors || device_name.match(/^(Linking Board01|BLEAD\\-LK\\-TSH)/)) {\n      this.services.button = {\n        onnotify: null,\n      };\n    }\n    // LED\n    if (\"LED\" in this.info.settings) {\n      const o = this.info.settings.LED;\n      if (o.colors && o.colors.length > 0 && o.patterns && o.patterns.length > 0) {\n        const colors: any = {};\n        for (let i = 0; i < o.colors.length; i++) {\n          colors[o.colors[i]] = i + 1;\n        }\n        const patterns: any = {};\n        for (let i = 0; i < o.patterns.length; i++) {\n          patterns[o.patterns[i]] = i + 1;\n        }\n        this.services.led = {\n          colors,\n          patterns,\n          turnOn: this._ledTurnOn.bind(this),\n          turnOff: this._ledTurnOff.bind(this),\n        };\n      }\n    }\n    // Vibration\n    if (\"Vibration\" in this.info.settings) {\n      const o = this.info.settings.Vibration;\n      if (o.patterns && o.patterns.length > 0) {\n        const patterns: any = {};\n        for (let i = 0; i < o.patterns.length; i++) {\n          patterns[o.patterns[i]] = i + 1;\n        }\n        this.services.vibration = {\n          patterns,\n          turnOn: this._vibrationTurnOn.bind(this),\n          turnOff: this._vibrationTurnOff.bind(this),\n        };\n      }\n    }\n    // Gyroscope\n    if (\"Gyroscope\" in this.info.capabilities) {\n      this.services.gyroscope = this._createSensorServiceObject(0x00);\n    }\n    // Accelerometer\n    if (\"Accelerometer\" in this.info.capabilities) {\n      this.services.accelerometer = this._createSensorServiceObject(0x01);\n    }\n    // Orientation\n    if (\"Orientation\" in this.info.capabilities) {\n      this.services.orientation = this._createSensorServiceObject(0x02);\n    }\n    // Battery\n    if (\"Battery\" in this.info.capabilities) {\n      this.services.battery = this._createSensorServiceObject(0x03);\n    }\n    // Temperature\n    if (\"Temperature\" in this.info.capabilities) {\n      this.services.temperature = this._createSensorServiceObject(0x04);\n    }\n    // Humidity\n    if (\"Humidity\" in this.info.capabilities) {\n      this.services.humidity = this._createSensorServiceObject(0x05);\n    }\n    // Atmospheric pressure\n    if (\"Atmospheric pressure\" in this.info.capabilities) {\n      this.services.pressure = this._createSensorServiceObject(0x06);\n    }\n    // Opening and closing\n    if (\"Opening and closing\" in this.info.exsensors) {\n      this.services.openclose = this._createSensorServiceObject(0x07);\n    }\n    // Human detection\n    if (\"Human detection\" in this.info.exsensors) {\n      this.services.human = this._createSensorServiceObject(0x08);\n    }\n    // Move\n    if (\"Move\" in this.info.exsensors) {\n      this.services.move = this._createSensorServiceObject(0x09);\n    }\n    // Illuminance\n    if (\"Illuminance\" in this.info.exsensors) {\n      this.services.illuminance = this._createSensorServiceObject(0x0a);\n    }\n  }\n\n  public _deviceNameGet() {\n    const promise = new Promise((resolve, reject) => {\n      const char = this._generic_access_service.device_name.char;\n      char.read((error: any, data: any) => {\n        if (error) {\n          reject(error);\n        } else {\n          resolve({\n            deviceName: data.toString(\"utf8\"),\n          });\n        }\n      });\n    });\n    return promise;\n  }\n\n  public _deviceNameSet(name: string) {\n    const promise = new Promise((resolve, reject) => {\n      if (!name) {\n        reject(new Error(\"Device name is required.\"));\n        return;\n      } else if (typeof name !== \"string\") {\n        reject(new Error(\"Device name must be a string.\"));\n        return;\n      } else if (name.length > 32) {\n        reject(new Error(\"Device name is too long. The length must be in the range 1 to 32.\"));\n        return;\n      }\n      const buf = Buffer.from(name, \"utf8\");\n      const char = this._generic_access_service.device_name.char;\n      char.write(buf, false, (error: any) => {\n        if (error) {\n          reject(error);\n        } else {\n          resolve();\n        }\n      });\n    });\n    return promise;\n  }\n\n  public _ledTurnOn(color: any, pattern: any, duration: any) {\n    let color_number = 1;\n    if (color) {\n      const colors = this.services.led.colors;\n      if (typeof color === \"number\") {\n        for (const name in colors) {\n          if (colors[name] === color) {\n            color_number = color;\n            break;\n          }\n        }\n      } else if (typeof color === \"string\") {\n        if (color in colors) {\n          color_number = colors[color];\n        }\n      }\n    }\n    let pattern_number = 2;\n    if (pattern) {\n      const patterns = this.services.led.patterns;\n      if (typeof pattern === \"number\") {\n        for (const name in patterns) {\n          if (patterns[name] === pattern) {\n            pattern_number = pattern;\n            break;\n          }\n        }\n      } else if (typeof pattern === \"string\") {\n        if (pattern in patterns) {\n          pattern_number = patterns[pattern];\n        }\n      }\n    }\n    if (!duration || typeof duration !== \"number\" || duration % 1 !== 0) {\n      duration = 5;\n    }\n    const promise = new Promise((resolve, reject) => {\n      this.write(\"SELECT_SETTING_INFORMATION\", {\n        SettingInformationRequest: {\n          requestName: \"START_DEMONSTRATION\",\n        },\n        SettingInformationData: [\n          {\n            settingName: \"LED\",\n            colorNumber: color_number,\n            patternNumber: pattern_number,\n            duration,\n          },\n        ],\n      })\n        .then((res: any) => {\n          resolve(res.data);\n        })\n        .catch((error) => {\n          reject(error);\n        });\n    });\n    return promise;\n  }\n\n  public _ledTurnOff() {\n    const promise = new Promise((resolve, reject) => {\n      this.write(\"SELECT_SETTING_INFORMATION\", {\n        SettingInformationRequest: {\n          requestName: \"STOP_DEMONSTRATION\",\n        },\n      })\n        .then((res: any) => {\n          resolve(res.data);\n        })\n        .catch((error) => {\n          reject(error);\n        });\n    });\n    return promise;\n  }\n\n  public _vibrationTurnOn(pattern: any, duration: any) {\n    let pattern_number = 2;\n    if (pattern) {\n      const patterns = this.services.vibration.patterns;\n      if (typeof pattern === \"number\") {\n        for (const name in patterns) {\n          if (patterns[name] === pattern) {\n            pattern_number = pattern;\n            break;\n          }\n        }\n      } else if (typeof pattern === \"string\") {\n        if (pattern in patterns) {\n          pattern_number = patterns[pattern];\n        }\n      }\n    }\n    if (!duration || typeof duration !== \"number\" || duration % 1 !== 0) {\n      duration = 5;\n    }\n    const promise = new Promise((resolve, reject) => {\n      this.write(\"SELECT_SETTING_INFORMATION\", {\n        SettingInformationRequest: {\n          requestName: \"START_DEMONSTRATION\",\n        },\n        SettingInformationData: [\n          {\n            settingName: \"Vibration\",\n            patternNumber: pattern_number,\n            duration,\n          },\n        ],\n      })\n        .then((res: any) => {\n          resolve(res.data);\n        })\n        .catch((error) => {\n          reject(error);\n        });\n    });\n    return promise;\n  }\n\n  public _vibrationTurnOff() {\n    const promise = new Promise((resolve, reject) => {\n      this.write(\"SELECT_SETTING_INFORMATION\", {\n        SettingInformationRequest: {\n          requestName: \"STOP_DEMONSTRATION\",\n        },\n      })\n        .then((res: any) => {\n          resolve(res.data);\n        })\n        .catch((error) => {\n          reject(error);\n        });\n    });\n    return promise;\n  }\n\n  public _createSensorServiceObject(sensor_type: any) {\n    return {\n      onnotify: null,\n      start: () => {\n        return this._setNotifySensorInfo(sensor_type, 1);\n      },\n      stop: () => {\n        return this._setNotifySensorInfo(sensor_type, 0);\n      },\n      get: () => {\n        return this._getSensorInfo(sensor_type);\n      },\n    };\n  }\n\n  public _setNotifySensorInfo(sensor_type: any, status: any) {\n    const promise = new Promise((resolve, reject) => {\n      this.write(\"SET_NOTIFY_SENSOR_INFO\", {\n        SensorType: sensor_type,\n        Status: status,\n      })\n        .then((res: any) => {\n          resolve(res.data);\n        })\n        .catch((error) => {\n          reject(error);\n        });\n    });\n    return promise;\n  }\n\n  public _getSensorInfo(sensor_type: any) {\n    const promise = new Promise((resolve, reject) => {\n      this.write(\"GET_SENSOR_INFO\", {\n        SensorType: sensor_type,\n      })\n        .then((res: any) => {\n          if (sensor_type.toString().match(/^(0|1|2)$/)) {\n            // Gyroscope, Accelerometer, Orientation\n            const d = res.data;\n            const data = {\n              x: d.xValue,\n              y: d.yValue,\n              z: d.zValue,\n            };\n            resolve(data);\n          } else {\n            resolve(res.data);\n          }\n        })\n        .catch((error) => {\n          reject(error);\n        });\n    });\n    return promise;\n  }\n}\n"]}