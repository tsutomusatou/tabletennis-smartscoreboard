{"version":3,"sources":["../src/parts/Ble/LogttaAD/index.ts"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["/**\n * @packageDocumentation\n * @module Parts.Logtta_AD\n */\n\nimport Obniz from \"../../../obniz\";\nimport bleRemotePeripheral from \"../../../obniz/libs/embeds/bleHci/bleRemotePeripheral\";\nimport BleRemotePeripheral from \"../../../obniz/libs/embeds/bleHci/bleRemotePeripheral\";\nimport ObnizPartsBleInterface, { ObnizPartsBleInfo } from \"../../../obniz/ObnizPartsBleInterface\";\n\nexport interface Logtta_ADOptions {}\n\nexport interface Logtta_AD_Data {\n  ampere: number;\n  volt: number;\n  count: number;\n}\nexport default class Logtta_AD implements ObnizPartsBleInterface {\n  public static info(): ObnizPartsBleInfo {\n    return {\n      name: \"Logtta_AD\",\n    };\n  }\n\n  public static isDevice(peripheral: BleRemotePeripheral) {\n    return peripheral.localName === \"Analog\";\n  }\n\n  private static get_uuid(uuid: string): string {\n    return `4e43${uuid}-6687-4f3c-a1c3-1c327583f29d`;\n  }\n\n  public onNotify?: (data: Logtta_AD_Data) => void;\n  public _peripheral: null | BleRemotePeripheral;\n  public ondisconnect?: (reason: any) => void;\n\n  constructor(peripheral: BleRemotePeripheral | null) {\n    if (peripheral && !Logtta_AD.isDevice(peripheral)) {\n      throw new Error(\"peripheral is not logtta AD\");\n    }\n    this._peripheral = peripheral;\n  }\n\n  public async connectWait() {\n    if (!this._peripheral) {\n      throw new Error(\"Logtta AD not found\");\n    }\n    if (!this._peripheral.connected) {\n      this._peripheral.ondisconnect = (reason: any) => {\n        if (typeof this.ondisconnect === \"function\") {\n          this.ondisconnect(reason);\n        }\n      };\n      await this._peripheral.connectWait();\n    }\n  }\n\n  public async disconnectWait() {\n    if (this._peripheral && this._peripheral.connected) {\n      await this._peripheral.disconnectWait();\n    }\n  }\n\n  public async getAllWait(): Promise<Logtta_AD_Data | null> {\n    if (!(this._peripheral && this._peripheral.connected)) {\n      return null;\n    }\n\n    const c = this._peripheral!.getService(Logtta_AD.get_uuid(\"AE20\"))!.getCharacteristic(Logtta_AD.get_uuid(\"AE21\"));\n    const data: number[] = await c!.readWait();\n    return {\n      ampere: (((data[0] << 8) | data[1]) * 916) / 16,\n      volt: (((data[0] << 8) | data[1]) * 916) / 4,\n      count: (data[2] << 8) | data[3],\n    };\n  }\n\n  public async getAmpereWait(): Promise<number> {\n    return (await this.getAllWait())!.ampere;\n  }\n\n  public async getVoltWait(): Promise<number> {\n    return (await this.getAllWait())!.volt;\n  }\n\n  public async getCountWait(): Promise<number> {\n    return (await this.getAllWait())!.count;\n  }\n\n  public async startNotifyWait() {\n    if (!(this._peripheral && this._peripheral.connected)) {\n      return;\n    }\n\n    const c = this._peripheral!.getService(Logtta_AD.get_uuid(\"AE20\"))!.getCharacteristic(Logtta_AD.get_uuid(\"AE21\"));\n\n    await c!.registerNotifyWait((data: number[]) => {\n      if (this.onNotify) {\n        this.onNotify({\n          ampere: (16 / 916) * ((data[0] << 8) | data[1]),\n          volt: (4 / 916) * ((data[0] << 8) | data[1]),\n          count: (data[2] << 8) | data[3],\n        });\n      }\n    });\n  }\n}\n"]}