{"version":3,"sources":["../src/parts/Ble/iBS01T/index.ts"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["/**\n * @packageDocumentation\n * @module Parts.iBS01T\n */\n\nimport BleRemotePeripheral from \"../../../obniz/libs/embeds/bleHci/bleRemotePeripheral\";\nimport ObnizPartsBleInterface, { ObnizPartsBleInfo } from \"../../../obniz/ObnizPartsBleInterface\";\n\nexport interface IBS01TOptions {}\n\nexport interface IBS01T_Data {\n  button: boolean;\n  moving: boolean;\n  reed: boolean;\n  battery: number;\n  temperature: number;\n  humidity: number;\n}\n\nexport default class IBS01T implements ObnizPartsBleInterface {\n  public static info(): ObnizPartsBleInfo {\n    return {\n      name: \"iBS01T\",\n    };\n  }\n\n  public static isDevice(peripheral: BleRemotePeripheral): boolean {\n    if (this.deviceAdv.length > peripheral.adv_data.length) {\n      return false;\n    }\n    for (let index = 0; index < this.deviceAdv.length; index++) {\n      if (this.deviceAdv[index] === -1) {\n        continue;\n      }\n      if (peripheral.adv_data[index] === this.deviceAdv[index]) {\n        continue;\n      }\n      return false;\n    }\n    return !(\n      peripheral.adv_data[12] === 0xff &&\n      peripheral.adv_data[13] === 0xff &&\n      peripheral.adv_data[14] === 0xff &&\n      peripheral.adv_data[15] === 0xff\n    );\n  }\n\n  public static getData(peripheral: BleRemotePeripheral): IBS01T_Data | null {\n    if (!IBS01T.isDevice(peripheral)) {\n      return null;\n    }\n    const d: IBS01T_Data = {\n      button: false,\n      moving: false,\n      reed: false,\n      battery: (peripheral.adv_data[9] + peripheral.adv_data[10] * 256) * 0.01,\n      temperature: ObnizPartsBleInterface.signed16FromBinary(peripheral.adv_data[13], peripheral.adv_data[12]) * 0.01,\n      humidity: ObnizPartsBleInterface.signed16FromBinary(peripheral.adv_data[15], peripheral.adv_data[14]),\n    };\n\n    if (Boolean(peripheral.adv_data[11] & 0b0001)) {\n      d.button = true;\n    }\n    if (Boolean(peripheral.adv_data[11] & 0b0010)) {\n      d.moving = true;\n    }\n    if (Boolean(peripheral.adv_data[11] & 0b0100)) {\n      d.reed = true;\n    }\n    return d;\n  }\n\n  private static deviceAdv: number[] = [\n    0x02,\n    0x01,\n    0x06,\n    0x12,\n    0xff,\n    0x59, // Manufacturer vendor code\n    0x00, // Manufacturer vendor code\n    0x80, // Magic code\n    0xbc, // Magic code\n    -1, // Battery\n    -1, // Battery\n    -1, // Event\n    -1, // temp\n    -1, // temp\n    -1, // humid\n    -1, // humid\n    -1, // reserved\n    -1, // reserved\n    -1, // reserved\n    -1, // reserved\n    -1, // reserved\n    -1, // reserved\n  ];\n\n  public _peripheral: BleRemotePeripheral | null = null;\n\n  constructor() {}\n}\n"]}